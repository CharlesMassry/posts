<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/posts/styles.1fb089fd6da9742c5f3c.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/posts/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/posts/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/posts/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/posts/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/posts/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/posts/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/posts/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/posts/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/posts/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/posts/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/posts/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/posts/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/posts/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/posts/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/posts/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/posts/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/posts/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/posts/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/posts/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/posts/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/posts/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/posts/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/posts/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/posts/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/posts/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/posts/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/posts/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/posts/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/posts/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/posts/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/posts/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/posts/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/posts/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/posts/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/posts/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/posts/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/posts/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/posts/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/posts/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/posts/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/posts/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/posts/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/posts/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/posts/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/posts/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/posts/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/posts/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/posts/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/posts/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/posts/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/posts/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/posts/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}a{color:#800640}a:hover{color:#680534}</style><meta name="generator" content="Gatsby 2.15.20"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/posts/rss.xml"/><link rel="shortcut icon" href="/posts/icons/icon-48x48.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="manifest" href="/posts/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/posts/icons/icon-48x48.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="72x72" href="/posts/icons/icon-72x72.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="96x96" href="/posts/icons/icon-96x96.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="144x144" href="/posts/icons/icon-144x144.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="192x192" href="/posts/icons/icon-192x192.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="256x256" href="/posts/icons/icon-256x256.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="384x384" href="/posts/icons/icon-384x384.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="512x512" href="/posts/icons/icon-512x512.png?v=bbea9ff70255777b1eeac798c80af103"/><title data-react-helmet="true">Using Redis for Autocompletion on Rails | Charlie Massry</title><meta data-react-helmet="true" name="description" content="For a website that has search functionality, you might want to have autocompletion, so when the user starts typing it automatically pops up suggestions. This is…"/><meta data-react-helmet="true" property="og:title" content="Using Redis for Autocompletion on Rails"/><meta data-react-helmet="true" property="og:description" content="For a website that has search functionality, you might want to have autocompletion, so when the user starts typing it automatically pops up suggestions. This is…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Charlie Massry"/><meta data-react-helmet="true" name="twitter:title" content="Using Redis for Autocompletion on Rails"/><meta data-react-helmet="true" name="twitter:description" content="For a website that has search functionality, you might want to have autocompletion, so when the user starts typing it automatically pops up suggestions. This is…"/><link as="script" rel="preload" href="/posts/webpack-runtime-ca1efd1916a9f0809a05.js"/><link as="script" rel="preload" href="/posts/styles-7a4d70f0f1bbf7711526.js"/><link as="script" rel="preload" href="/posts/app-7c36618d629bc47a2d29.js"/><link as="script" rel="preload" href="/posts/commons-e6418c07ab7795fd598a.js"/><link as="script" rel="preload" href="/posts/component---src-templates-blog-post-js-5f5b8c0cf0dd10e5c1ef.js"/><link as="fetch" rel="preload" href="/posts/page-data/36-using-redis-for-autocompletion-on-rails/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/posts/">Charlie Massry</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Using Redis for Autocompletion on Rails</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">September 30, 2014</p></header><section><p>For a website that has search functionality, you might want to have autocompletion, so when the user starts typing it automatically pops up suggestions. This is actually pretty tricky to implement because of a couple of reasons, namely performance. The actual Javascript function of getting the text to pop up is actually really easy if you use the <a href="http://jqueryui.com/autocomplete/">JQuery-UI autocomplete</a> library.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$(function(){
  $(&quot;#q&quot;).autocomplete({
    source: &quot;/search_suggestions&quot;
  });
});</code></pre></div>
<p>Your application would need to have a <code class="language-text">/search_suggestion</code> path and JSON data at that path. The main question is how to model this data, specifically knowing that SQL queries can take a lot of time. Enter Redis.</p>
<p><a href="http://www.redis.io">Redis</a> is an in memory key-value store, which is exactly what we need. You can even try using Redis for free from <a href="http://try.redis.io/">your browser</a> The idea is to take all the searchable items, make an AJAX request when the user types each letter and render the results as JSON.</p>
<p>First you must setup Redis which is easy enough if you are on Mac OSX.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ brew install redis</code></pre></div>
<p>Next you can start the Redis server in a separate terminal tab.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ redis-server</code></pre></div>
<p>Once that is done you must configure Redis to work with Rails. Luckily, there’s a gem for that. In your Gemfile</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">gem &quot;redis&quot;</code></pre></div>
<p>Then</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ bundle install</code></pre></div>
<p>Now in <code class="language-text">config/initializers/redis.rb</code> you can have Redis work globally by assigning the instance to a global variable like</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$redis = Redis.new</code></pre></div>
<p>Since Redis is now configured, we must get Redis to work with the search suggestions.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">class SearchSuggestion
  def self.terms_for(prefix)
    $redis.zrevrange(&quot;search-suggestion:#{prefix.downcase}&quot;, 0, 9)
  end
end</code></pre></div>
<p>In controller you can just render the model as JSON.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">class SearchSuggestionsController &lt; ApplicationController
  def index
    render json: SearchSuggestion.terms_for(params[:term])
  end
end</code></pre></div>
<p>Nothing will be displayed however right now as <code class="language-text">#zrevrange</code> is equivalent to a <code class="language-text">SELECT</code> statement. So to insert the data, I recommend writing a rake task to index the terms, as you don’t want to have Rails process all of the indexing and get hung up.</p>
<p>You can write a rake task by creating a file in the <code class="language-text">lib/tasks</code> directory ending in <code class="language-text">.rake</code>, we’ll call it <code class="language-text">search_suggestion.rake</code>.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">namespace :search_suggestions do
  desc &quot;Generate search suggestions from location&quot;
  task index: :environment do
    SearchSuggestion.index_location
  end
end</code></pre></div>
<p>Now when you type in <code class="language-text">$ rake -T</code> you will see your rake task on the rake task list. You can run this task by simply typing</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ rake search_suggestions:index</code></pre></div>
<p>Now how do we form that <code class="language-text">.index_location</code> class method. We can take all of the locations and index each of them by their combined letters up to but not including their last letter. We also want to make each individual word indexed by its letters.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">def self.index_locations
  Location.find_each do |location|
    index_term(location.name)
    location.name.split.each { |term| index_term(term) }
  end
end

def self.index_term(term)
  1.upto(term.length - 1) do |n|
    prefix = term[0, n]
    $redis.zincrby(&quot;search-suggestion:#{prefix.downcase}&quot;, 1, term.downcase)
  end
end</code></pre></div>
<p>The entire location name is being indexed in the <code class="language-text">.index_term</code> method, and then the individual words are being indexed.</p>
<p>This will be much faster than just using <code class="language-text">SQL</code> queries, but you still probably want to squeeze out that last bit of performance. Well there is a way that involves modifying the Rack Middleware. If you’re not familiar with Rack Middleware, what happens when a request comes to your Rails application, the request passes through the Rack Middleware and each piece of Middleware changes the request on the way down until it finally reaches your application. We will want to change this because each piece of Middleware can add some time to the request. First, we must create the Middleware we want to add. We can make a new directory called <code class="language-text">app/middleware</code>. In this directory we can make the Middleware file <code class="language-text">search_suggestions.rb</code>.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">class SearchSuggestions
  def initialize(app)
    @app = app
  end

  def call(env)
    if env[&quot;PATH_INFO&quot;] == &quot;/search_suggestions&quot;
      request = Rack::Request.new(env)
      terms = SearchSuggestion.terms_for(request.params[&quot;term&quot;])
      [200, {&quot;Content-Type&quot; =&gt; &quot;application/json&quot;}, [terms.to_json]]
    else
      @app.call(env)
    end
  end
end</code></pre></div>
<p>Each Middleware is initialized with the Application object and each middleware uses the <code class="language-text">#call</code> method on the Application. This is a form of polymorphism as all each Middleware must do is respond to <code class="language-text">#call</code>. Here the request is instantiated with the Application object and the <code class="language-text">params[&quot;term&quot;]</code> is extracted to call the search suggestion. The result is then sent back to the client as JSON. To add the Middleware to the top of the stack, you want to go into <code class="language-text">config/application.rb</code>, and inside of the Application class, add</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">config.middleware.insert_before(0, &quot;SearchSuggestions&quot;)</code></pre></div>
<p>This inserts the middleware at the front, and now you are all setup with fast autocompletion. There is still some CSS issues that you will run into as the JQuery-UI autocomplete doesn’t add any CSS, but I’ll leave that to you.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAAB860aO9ZlC5VkCP8A/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxEhMf/aAAgBAQABBQInQ1eV14V4AWZoNnphY7//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BI//EABkQAAIDAQAAAAAAAAAAAAAAAAARARAxIf/aAAgBAQAGPwLOjls6qTNgg2v/xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhQTFhgf/aAAgBAQABPyFMfTkq/DtzCVKr/SCJS/2adJ3sKMHezwM1W1kJH//aAAwDAQACAAMAAAAQOxC9/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEXH/2gAIAQMBAT8Q0tij/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQIBAT8QjyD10Ykof//EAB4QAQEAAgICAwAAAAAAAAAAAAERACExQWGBkdHw/9oACAEBAAE/EAVY9jM56hBBRkO7gCSkCrPnFSJm0ar+c2vIzQM7uJIIiDC8C20AdGsIKYUr5PvJIdS8Z//Z" alt="Charlie Massry" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/posts/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg 1x,
/posts/static/1948370226dd40e0ab4d36b53244f1eb/06a10/profile-pic.jpg 1.5x,
/posts/static/1948370226dd40e0ab4d36b53244f1eb/f1b5a/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/posts/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg 1x,
/posts/static/1948370226dd40e0ab4d36b53244f1eb/06a10/profile-pic.jpg 1.5x,
/posts/static/1948370226dd40e0ab4d36b53244f1eb/f1b5a/profile-pic.jpg 2x" src="/posts/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg" alt="Charlie Massry" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Charlie Massry</strong> who lives and works in New York building useful things.<!-- --> <a href="https://twitter.com/CharlesMassry">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/posts/35-google-maps-on-rails/">← <!-- -->Google Maps on Rails</a></li><li><a rel="next" href="/posts/37-don-t-use-your-mouse-for-text-editing-with-vim/">Don&#x27;t Use Your Mouse for Text Editing with Vim<!-- --> →</a></li></ul></nav></main><footer>© 2013 — <!-- -->2019</footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/36-using-redis-for-autocompletion-on-rails/";window.webpackCompilationHash="5f59af403a2cb5cd3f33";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-7c36618d629bc47a2d29.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-dcf9d95df1932c1d2c63.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-5f5b8c0cf0dd10e5c1ef.js"],"component---src-pages-404-js":["/component---src-pages-404-js-812dfb18c72d368f5100.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2ec1a5592c1efb7e8aac.js"]};/*]]>*/</script><script src="/posts/component---src-templates-blog-post-js-5f5b8c0cf0dd10e5c1ef.js" async=""></script><script src="/posts/commons-e6418c07ab7795fd598a.js" async=""></script><script src="/posts/app-7c36618d629bc47a2d29.js" async=""></script><script src="/posts/styles-7a4d70f0f1bbf7711526.js" async=""></script><script src="/posts/webpack-runtime-ca1efd1916a9f0809a05.js" async=""></script></body></html>