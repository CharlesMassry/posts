<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.7342611b80438677159f.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}a{color:#800640}a:hover{color:#680534}</style><meta name="generator" content="Gatsby 2.15.20"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bbea9ff70255777b1eeac798c80af103"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bbea9ff70255777b1eeac798c80af103"/><title data-react-helmet="true">Mock external services with a VCR | Charlie Massry</title><meta data-react-helmet="true" name="description" content="When creating an Rails App using TDD, sometimes you will come across the need for an external service, for example, using the Google Maps API. Over the course…"/><meta data-react-helmet="true" property="og:title" content="Mock external services with a VCR"/><meta data-react-helmet="true" property="og:description" content="When creating an Rails App using TDD, sometimes you will come across the need for an external service, for example, using the Google Maps API. Over the course…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Charlie Massry"/><meta data-react-helmet="true" name="twitter:title" content="Mock external services with a VCR"/><meta data-react-helmet="true" name="twitter:description" content="When creating an Rails App using TDD, sometimes you will come across the need for an external service, for example, using the Google Maps API. Over the course…"/><link as="script" rel="preload" href="/webpack-runtime-3b421740133aaf7cf9b0.js"/><link as="script" rel="preload" href="/styles-7ca53a8554fd79cc8a8c.js"/><link as="script" rel="preload" href="/app-e5cacde327914aca4191.js"/><link as="script" rel="preload" href="/commons-75c7e3e47baf301970b5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-fcb3d47251e8393feee5.js"/><link as="fetch" rel="preload" href="/page-data/posts/40-mock-external-services-with-a-vcr/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Charlie Massry</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Mock external services with a VCR</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">October 10, 2014</p></header><section><p>When creating an Rails App using TDD, sometimes you will come across the need for an external service, for example, using the Google Maps API. Over the course of testing, you will find that anything that accesses an external service, takes too long, doesn’t work without internet connection, and adds to your request limit. This can be very problematic if you do programming offline, say on a train, as those tests that use external services will all fail. How to solve this problem and still get your tests to pass can sound complicated at first, but there’s a gem for that.</p>
<p>We will actually be using two gems for this, one to block the tests from contacting anything but <code class="language-text">localhost</code> and one to grab the response once from the external service and refer to the original response on every subsequent test.</p>
<p>The first gem is <a href="https://github.com/bblimke/webmock">WebMock</a> to disable HTTP requests. To begin add to your <code class="language-text">Gemfile</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">gem &quot;webmock&quot;</code></pre></div>
<p>and run</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ bundle install</code></pre></div>
<p>At the top of <code class="language-text">spec_helper.rb</code>, you will need to add</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">require &quot;webmock/rspec&quot;</code></pre></div>
<p>WebMock.disable<em>net</em>connect!(allow_localhost: true)</p>
<p>This inserts WebMock into your tests so now you can’t access any external services and the tests will yell at you when you try with an error message like</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">WebMock::NetConnectNotAllowedError:
Real HTTP connections are disabled. Unregistered request: GET &quot;http://maps.googleapis.com/maps/api/geocode/json?address=350%205th%20Avenue%20New%20York,%20NY%2010118&amp;language=en&amp;sensor=false&quot; with headers {&#39;Accept&#39;=&gt;&#39;*/*&#39;, &#39;Accept-Encoding&#39;=&gt;&#39;gzip;q=1.0,deflate;q=0.6,identity;q=0.3&#39;, &#39;User-Agent&#39;=&gt;&#39;Ruby&#39;}</code></pre></div>
<p> You can stub this request with the following snippet:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">stub_request(:get, &quot;http://maps.googleapis.com/maps/api/geocode/json?address=350%205th%20Avenue%20New%20York,%20NY%2010118&amp;language=en&amp;sensor=false&quot;).
  with(:headers =&gt; {&#39;Accept&#39;=&gt;&#39;*/*&#39;, &#39;Accept-Encoding&#39;=&gt;&#39;gzip;q=1.0,deflate;q=0.6,identity;q=0.3&#39;, &#39;User-Agent&#39;=&gt;&#39;Ruby&#39;}).
  to_return(:status =&gt; 200, :body =&gt; &quot;&quot;, :headers =&gt; {})

registered request stubs:

stub_request(:get, &quot;http://maps.googleapis.com/&quot;).
  with(:headers =&gt; {&#39;Accept&#39;=&gt;&#39;*/*&#39;, &#39;User-Agent&#39;=&gt;&#39;Ruby&#39;})

============================================================</code></pre></div>
<p>This gem is cool that it tells you how to fix it, but you would have to type out exactly what you want to get from the external service, as it doesn’t know what is supposed to be in the body. Wouldn’t it be cool to just run the test once and all of the response gets copied for later usage. The <a href="https://github.com/vcr/vcr">VCR</a> gem does just that. To get that working, in your <code class="language-text">Gemfile</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">gem &quot;vcr&quot;</code></pre></div>
<p>and run</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ bundle install</code></pre></div>
<p>Now we must configure VCR to stop WebMock once to record, and then stub out the request every subsequent time. To configure make a <code class="language-text">vcr_setup.rb</code> file in <code class="language-text">spec/support</code> and you will add the configuration details like</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">require &quot;vcr&quot;

VCR.configure do |c|
  c.cassette_library_dir = &quot;vcr_cassettes&quot;
  c.hook_into :webmock
end</code></pre></div>
<p>What this is doing is creating a directory called <code class="language-text">vcr_cassettes</code> and creating a response YAML file for each unique request in that directory. Since it is a very modular gem, it allows you to interact with not just WebMock but other gems as well, so we need to tell it which gem we are using.</p>
<p>When you run the tests it will then tell you where it is failing and give you an idea of how to fix it, but the error message can seem a little unnecessary. All it really wants you to do is every time you are making a request to the same external service, just wrap it in a VCR block. For example,</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">describe Location do
  context &quot;.search&quot; do
    it &quot;returns a correct search result&quot; do
      VCR.use_cassette(&quot;geolocate&quot;) do
        @location = create(:location)
      end

      expect(Location.search(&quot;Empire State Building&quot;)).to include(@location)
    end
  end
end</code></pre></div>
<p>The first time you run the test it will contact Google Maps and record the response in a YAML file in <code class="language-text">vcr_cassettes/geolocate.yml</code> and will grab that response on every subsequent test where the name passed in to <code class="language-text">.use_cassette</code> is the same. One thing to note is when you are running an integration test, you only need to wrap whatever creates the location in the <code class="language-text">VCR.use_cassette</code> block, so with Capybara</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">...
fill_in &quot;Name&quot;, with: location.name

VCR.use_cassette(&quot;geolocate&quot;) do
  click_button &quot;Add Location&quot;
end
...</code></pre></div>
<p>Your tests will now pass on a plane or a train, almost like you have a cassette player with you.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAAB860aO9ZlC5VkCP8A/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxEhMf/aAAgBAQABBQInQ1eV14V4AWZoNnphY7//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BI//EABkQAAIDAQAAAAAAAAAAAAAAAAARARAxIf/aAAgBAQAGPwLOjls6qTNgg2v/xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhQTFhgf/aAAgBAQABPyFMfTkq/DtzCVKr/SCJS/2adJ3sKMHezwM1W1kJH//aAAwDAQACAAMAAAAQOxC9/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEXH/2gAIAQMBAT8Q0tij/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQIBAT8QjyD10Ykof//EAB4QAQEAAgICAwAAAAAAAAAAAAERACExQWGBkdHw/9oACAEBAAE/EAVY9jM56hBBRkO7gCSkCrPnFSJm0ar+c2vIzQM7uJIIiDC8C20AdGsIKYUr5PvJIdS8Z//Z" alt="Charlie Massry" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg 1x,
/static/1948370226dd40e0ab4d36b53244f1eb/06a10/profile-pic.jpg 1.5x,
/static/1948370226dd40e0ab4d36b53244f1eb/f1b5a/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg 1x,
/static/1948370226dd40e0ab4d36b53244f1eb/06a10/profile-pic.jpg 1.5x,
/static/1948370226dd40e0ab4d36b53244f1eb/f1b5a/profile-pic.jpg 2x" src="/static/1948370226dd40e0ab4d36b53244f1eb/9b664/profile-pic.jpg" alt="Charlie Massry" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Charlie Massry</strong> who lives and works in New York building useful things.<!-- --> <a href="https://twitter.com/CharlesMassry">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/posts/39-devise-guest-user/">← <!-- -->Devise Guest User</a></li><li><a rel="next" href="/posts/41-raw-sql-on-rails/">Raw SQL on Rails<!-- --> →</a></li></ul></nav></main><footer>© 2013 — <!-- -->2019</footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/40-mock-external-services-with-a-vcr/";window.webpackCompilationHash="8ad048b9041a01a887b8";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e5cacde327914aca4191.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-dcf9d95df1932c1d2c63.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-fcb3d47251e8393feee5.js"],"component---src-pages-404-js":["/component---src-pages-404-js-812dfb18c72d368f5100.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2abf7f7ff1efceabd07a.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-fcb3d47251e8393feee5.js" async=""></script><script src="/commons-75c7e3e47baf301970b5.js" async=""></script><script src="/app-e5cacde327914aca4191.js" async=""></script><script src="/styles-7ca53a8554fd79cc8a8c.js" async=""></script><script src="/webpack-runtime-3b421740133aaf7cf9b0.js" async=""></script></body></html>