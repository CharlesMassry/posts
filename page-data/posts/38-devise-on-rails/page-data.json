{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/38-devise-on-rails/","webpackCompilationHash":"8ad048b9041a01a887b8","result":{"data":{"site":{"siteMetadata":{"title":"Charlie Massry","author":"Charlie Massry"}},"markdownRemark":{"id":"739dcfd4-21c7-5140-a64a-982aea7efb6b","excerpt":"With most web apps, you’ll want to have some type of authentication system so your users’ data is secure. The question then shifts of how to implement user…","html":"<p>With most web apps, you’ll want to have some type of authentication system so your users’ data is secure. The question then shifts of how to implement user authentication, while you can roll your own, like I described in an earlier <a href=\"/posts/13\">post</a>, it can become a time sink really quickly but fortunately there’s a gem for that. There are actually many gems for authentication, in fact, if you look at the <a href=\"https://www.ruby-toolbox.com/categories/rails_authentication\">Ruby Toolbox page</a>, there are 19 to be exact. Topping the charts is the popular gem <a href=\"http://devise.plataformatec.com.br/\">Devise</a> from our friends over at <a href=\"http://plataformatec.com.br/\">Plataformatec</a> in Brazil.</p>\n<p>Devise provides many features and has 10 different modules such as the Omniauth support. It can however be difficult to set up, and even the documentation explicitly states to look into how authentication works in Rails and provides some links to sources that detail how to roll your own. To get started, add to your Gemfile</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gem &quot;devise&quot;</code></pre></div>\n<p>Next run the Devise generate command</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rails generate devise:install</code></pre></div>\n<p>This generates two files, <code class=\"language-text\">config/initializers/devise.rb</code> and <code class=\"language-text\">config/locales/devise.en.yml</code>. <code class=\"language-text\">devise.rb</code> holds different configuration values, such as password length or email validation and <code class=\"language-text\">devise.en.yml</code> holds different Devise messages such as confirmation instructions. Now that you have these files, you can create users. You can call your users anything you want, but if you are just getting started you would probably just want to call them users. To do that you must make sure your database is created and then you can generate your User model with Devise.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rails generate devise User</code></pre></div>\n<p>This generates a couple of files, the migration and the User model. When you check the migration you will see a lot of cool database columns that will be created and auto-tracked, such as from the Trackable module, like <code class=\"language-text\">last_sign_in_ip</code> or <code class=\"language-text\">last_sign_in_at</code>. You can add your own as you please like <code class=\"language-text\">username</code> or <code class=\"language-text\">first_name</code> and <code class=\"language-text\">last_name</code> for example. This however requires some configuration due to the Strong Params in Rails 4. For example, lets add first name and last name support for the users. In our created migration</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">class DeviseCreateUsers &lt; ActiveRecord::Migration\n  def change\n    create_table(:users) do |t|\n      ...\n      t.string :first_name\n      t.string :last_name\n      ...\n    end\n    ...\n  end\nend</code></pre></div>\n<p>Now that we’ve finished the migration</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rake db:migrate</code></pre></div>\n<p>To add the new columns to our view forms we must enter into the forms located in <code class=\"language-text\">app/views/devise/registrations/new.html.erb</code>. To even see the Devise created views within your app enter</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rails generate devise:views</code></pre></div>\n<p>This creates the Devise views in the <code class=\"language-text\">views/devise</code> directory.</p>\n<p>Within the <code class=\"language-text\">form_for</code> block add</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div&gt;\n  &lt;%= f.label :first_name %&gt;\n  &lt;%= f.text_field :first_name %&gt;\n&lt;/div&gt;\n&lt;div&gt;\n  &lt;%= f.label :last_name %&gt;\n  &lt;%= f.text_field :last_name %&gt;\n&lt;/div&gt;</code></pre></div>\n<p>When we submit this form however, it will not work because of the Strong Parameters I mentioned earlier, which really highlights what I think is one of the main problems with Devise, as opposed to a simpler gem like <a href=\"https://github.com/halogenandtoast/monban\">Monban</a>, it hides too much of what is going on which makes modification difficult. To add the first name and last name fields, we won’t create a Devise controller like we did with the views, instead we will modify the <code class=\"language-text\">ApplicationController</code> with a <code class=\"language-text\">before_action</code> to modify a hidden Devise controller</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">class ApplicationController &lt; ActionController::Base\n  ...\n  before_action :configure_permitted_parameters, if: :devise_controller?\n\n  protected\n\n  def configure_permitted_parameters\n    devise_parameter_sanitizer.for(:sign_up) &lt;&lt; [:first_name, :last_name]\n  end\nend</code></pre></div>\n<p>You can create your own controller using the Devise controller generator which you might want to switch to if your application grows and needs more customization or different types of users with different sign in processes. But for now, your User model is ready to roll with Devise and any extra fields you care to add to users.</p>","frontmatter":{"title":"Devise on Rails","date":"October 07, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/38-devise-on-rails/","previous":{"fields":{"slug":"/posts/37-don-t-use-your-mouse-for-text-editing-with-vim/"},"frontmatter":{"title":"Don't Use Your Mouse for Text Editing with Vim","id":37}},"next":{"fields":{"slug":"/posts/39-devise-guest-user/"},"frontmatter":{"title":"Devise Guest User","id":39}}}}}