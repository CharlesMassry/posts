{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/7-database-control-in-ruby/","webpackCompilationHash":"2dce4ec31986faad0911","result":{"data":{"site":{"siteMetadata":{"title":"Charlie Massry","author":"Charlie Massry"}},"markdownRemark":{"id":"81d8a0f9-e27f-5d3e-b33b-2fcb8d1ae079","excerpt":"Active Record is the preferred method of interacting with a database. Being a Ruby Gem independent of Ruby on Rails, Active Record can work with other…","html":"<p>Active Record is the preferred method of interacting with a database. Being a Ruby Gem independent of Ruby on Rails, Active Record can work with other frameworks such as Sinatra. <a href=\"https://github.com/rails/rails/tree/master/activerecord\">Active Record</a> is simple to setup and the commands are not confusing at all.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SELECT galleries.*\nFROM galleries\nWHERE (name = &#39;Cats&#39;);</code></pre></div>\n<p>This would return all database entries in the galleries table that have name equal to ‘Cats’. This is good, but it is kind of a long statement to type out and you can’t interact with it much by just using SQL. For example, putting it on the web would be a lot more difficult.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Gallery.where(&quot;name = &#39;Cats&#39;&quot;)</code></pre></div>\n<p>This gives you the same result as the previous SQL statement, except you can now interact with it in Ruby, and thus Sinatra and put it on the web.</p>\n<p>But Charlie, that’s all well and good but how do you use a <code class=\"language-text\">JOIN</code> command with Active Record, you ask? Well if you want to join a galleries to an images table you would write:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">class Image &lt; ActiveRecord::Base\nend\n\nclass Gallery &lt; ActiveRecord::Base\n  has_many :images\nend  </code></pre></div>\n<p>The has many method returns all of the images that are associated with the gallery where the Foreign ID of the images is equal to the ID of the gallery, only when you call the images getter method. Active Record automagically creates all these different methods for the database, such as all getter and setter attribute methods, just never use the ID or Foreign ID setter methods otherwise you’ll ruin your database.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@gallery = Gallery.find_by(name: “Cats”)` </code></pre></div>\n<p>This Ruby query would return <code class=\"language-text\">#&lt;Gallery id: 1, name: &quot;Cats&quot;, description: &quot;Funky cats”&gt;</code>. If you then wrote <code class=\"language-text\">@images = @gallery.images</code>, the return value would be a long listing of every image that matches its Foreign ID to the ID of the gallery. You can then iterate through the <code class=\"language-text\">@images</code> instance variable and post each image to the web using Sinatra and an ERB template.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@galleries = Gallery.where(&quot;name = &#39;Cats’”)\n@images = @galleries.map { |gallery| gallery.images }\n@images.flatten!\n@images.each { |image| image.url }</code></pre></div>\n<p>This would return a list of all the URLs that correspond to the Cats gallery. The reason for this seemingly complex code is because <code class=\"language-text\">.where(“name = ‘Cats’”)</code> returns an array that needs to be iterated through to find the images and then flatten the array that <code class=\"language-text\">.map</code> returns. You are then left with one array and can iterate through that array to return each image URL.</p>\n<p>In any event, just make sure that your casing is correct.</p>","frontmatter":{"title":"Database Control in Ruby","date":"June 26, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/7-database-control-in-ruby/","previous":{"fields":{"slug":"/posts/6-when-in-doubt-restart-your-server/"},"frontmatter":{"title":"When in Doubt, Restart Your Server","id":6}},"next":{"fields":{"slug":"/posts/8-http-requests-in-sinatra/"},"frontmatter":{"title":"HTTP Requests in Sinatra","id":8}}}}}