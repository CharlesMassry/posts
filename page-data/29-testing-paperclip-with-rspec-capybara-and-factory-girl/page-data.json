{"componentChunkName":"component---src-templates-blog-post-js","path":"/29-testing-paperclip-with-rspec-capybara-and-factory-girl/","webpackCompilationHash":"fef329071fa7503060c9","result":{"data":{"site":{"siteMetadata":{"title":"Charlie Massry","author":"Charlie Massry"}},"markdownRemark":{"id":"5814f93a-d21e-5c34-8820-c00064809293","excerpt":"Recently I’ve been working on a project that allows users to upload photos or videos with the twist of using the same form and determining file type on the…","html":"<p>Recently I’ve been working on a project that allows users to upload photos or videos with the twist of using the same form and determining file type on the server. I decided to go this route because of the positive user experience a form that tells you to add either media type gives you. Regardless, manually testing the form can be a pain because it must be a photo or a video and the form can’t be blank. This can involve a lot of work to test manually, between the clicking of the form, and clicking through to the path to the file. Enter feature specs.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">require &quot;rails_helper&quot;\n\nfeature &quot;Media creation&quot; do\n  before(:each) do\n    @team = create(:team)\n    @user = create(:user, team: @team)\n    @play = create(:play, team: @team)\n    sign_in(@user)\n    visit team_play_path(@team, @play)\n    click_link &quot;Add photo or video&quot;\n  end\n\n  scenario &quot;I can add a photo to plays&quot; do\n    medium = build(:photo_medium)\n\n    attach_file &quot;File&quot;, &quot;spec/asset_specs/photos/photo.jpg&quot;\n    fill_in &quot;Caption&quot;, with: medium.caption\n    click_button &quot;Add photo or video&quot;\n\n    expect(page).to have_selector(&quot;img&quot;)\n  end\n\n  scenario &quot;I can add a video to plays&quot; do\n    medium = build(:video_medium)\n\n    attach_file &quot;File&quot;, &quot;spec/asset_specs/videos/video.MOV&quot;\n    fill_in &quot;Caption&quot;, with: medium.caption\n    click_button &quot;Add photo or video&quot;\n\n    expect(page).to have_selector(&quot;video&quot;)\n  end\n\n  scenario &quot;I cannot submit a blank file field&quot; do\n    click_button &quot;Add photo or video&quot;\n\n    expect(page).to have_selector(&quot;form&quot;)\n    expect(page).to have_css(&quot;#new_medium&quot;)\n  end\n\n  scenario &quot;I cannot submit an invalid file type&quot; do\n    attach_file &quot;File&quot;, &quot;spec/asset_specs/fail/erd.pdf&quot;\n    fill_in &quot;Caption&quot;, with: &quot;should not work&quot;\n    click_button &quot;Add photo or video&quot;\n\n    expect(page).to have_selector(&quot;form&quot;)\n    expect(page).to have_css(&quot;#new_medium&quot;)\n  end\nend  </code></pre></div>\n<p>What is happening here is before each test is run, a team, user, and play are all created and the user is then signed in and visits the <code class=\"language-text\">plays#show</code> page. Each test is then run, testing the 4 different possibilities of photo, video, wrong file type, and blank field. The main benefit of using <a href=\"http://rspec.info/\">RSpec</a> and <a href=\"http://jnicklas.github.io/capybara/\">Capybara</a> is that this reads almost like pure English. The RSpec sections are the end of each test that compares the expectations with the result and the Capybara sections are the beginning of each test that describes the interaction with a web browser. <a href=\"https://github.com/thoughtbot/factory_girl\">Factory Girl</a>, (the Ruby Gem not the 2006 movie starring Sienna Miller) creates the data in the test database before each test is run with data referenced from a separate file. Now you can make all the changes to the site that you want and you’ll know if they’ll work now, and in the future.</p>","frontmatter":{"title":"Testing Paperclip with RSpec, Capybara, and Factory Girl","date":"August 22, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/29-testing-paperclip-with-rspec-capybara-and-factory-girl/","previous":{"fields":{"slug":"/28-multiple-images-with-paperclip/"},"frontmatter":{"title":"Multiple Images with PaperClip","id":28}},"next":{"fields":{"slug":"/30-nested-comments-with-active-record/"},"frontmatter":{"title":"Nested Comments with Active Record","id":30}}}}}